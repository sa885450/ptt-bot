# 🔥 PTT 萬能情報戰情室 (PTT Intelligence Room)

![Node.js](https://img.shields.io/badge/Node.js-v18%2B-green)
![License](https://img.shields.io/badge/license-MIT-blue)
![Version](https://img.shields.io/badge/version-7.1.0-orange)

> **全方位的 PTT 即時監控系統**
> 具備 Discord 通知、關鍵字過濾、市場情緒分析與 Web 戰情儀表板功能。

---

## 📋 目錄 (Table of Contents)
- [🚀 專案特色](#-專案特色)
- [🛠️ 版本更新日誌](#️-版本更新日誌-changelog)
- [⚠️ 升級注意事項](#️-升級注意事項-重要)

---

## 🚀 專案特色

* **即時監控**：自訂看板與推文數門檻，不錯過任何爆文。
* **智慧爬蟲**：支援深潛模式 (Deep Dive)，自動追蹤往回 N 頁的資料，防止洗版漏接。
* **情緒分析**：內建股市/幣圈關鍵字情緒字典，自動標記 `📈 利多` / `📉 利空`。
* **Web 儀表板**：
    * **黑科技 UI**：深色模式、霓虹熱度標籤、無干擾 AJAX 設定。
    * **歷史回溯**：專屬的歷史紀錄搜尋與篩選功能。
* **Discord 整合**：支援 Webhook 推播，手機也能收到即時戰報。

---

## 🛠️ 版本更新日誌 (Changelog)

### v7.1.0 (The Stability Update) - 2026/02/16

本次更新專注於 **連線穩定性** 與 **反爬蟲對策**，解決了長時間運行後容易出現的 `ECONNRESET` 錯誤。

#### 🕷️ 爬蟲核心優化 (Crawler)
* **自動重試機制 (Auto-Retry)**：新增智慧重試邏輯，當遇到網路波動或連線中斷時，自動等待 1 秒後重試（最多 3 次），大幅降低任務失敗率。
* **偽裝瀏覽器 (User-Agent Spoofing)**：現在爬蟲會偽裝成標準 Chrome 瀏覽器，避免被 PTT 伺服器判定為機器人而斷線。
* **連線增強**：啟用 HTTPS Keep-Alive 機制，並將逾時限制 (Timeout) 放寬至 10 秒，適應尖峰時刻的網路延遲。

---

### v7.0.0 (The Refactor Update) - 2026/02/16

本次更新專注於 **架構重構** 與 **穩定性提升**，並整合了 v6 系列的所有黑科技功能。

#### 🔧 核心架構 (Core)
* **模組化拆分**：將原本龐大的主程式拆解為 `engine.js` (戰情引擎)、`crawler.js` (爬蟲模組) 與 `logger.js` (日誌模組)。
* **代碼維護性**：大幅提升代碼可讀性與擴充彈性。

#### 🕷️ 智慧爬蟲 (Crawler)
* **Deep Dive 模式**：新增 `deepDive` 參數，爬蟲現在能自動處理「往回爬 N 頁」的遞迴邏輯，不再漏接快速洗版的文章。

#### 💾 資料庫 (Database)
* **自動防呆初始化**：增強資料庫初始化邏輯，啟動時自動檢查並建立所有欄位（看板、作者、推文數），防止新舊版衝突。

#### 🖥️ 旗艦儀表板 (UI)
整合了 v6.2 的所有前端黑科技：
* ✅ **情緒分析**：自動標記標題中的市場情緒 (利多/利空)。
* ✅ **歷史搜尋**：歷史紀錄分頁新增專屬的搜尋與過濾器。
* ✅ **無干擾體驗**：設定儲存改為 AJAX 無刷新模式。
* ✅ **視覺優化**：深色模式捲軸、霓虹熱度標籤。

---

## ⚠️ 升級注意事項 (重要!)

> **如果您是從 v6.x 或更早版本升級，請務必執行以下操作：**

由於 v7.0.0 對資料庫結構進行了嚴格規範，舊版的資料庫檔案可能會導致錯誤。

**請在啟動前刪除舊資料庫檔案：**

```bash
# Linux / Mac
rm crawler.db

# Windows (PowerShell)
del crawler.db